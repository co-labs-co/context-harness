(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3883:function(e,t,s){Promise.resolve().then(s.bind(s,1287))},1287:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return j}});var a=s(7437),r=s(2265),l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),i=(e,t)=>{let s=(0,r.forwardRef)((s,a)=>{let{color:i="currentColor",size:o=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:x="",children:h,...m}=s;return(0,r.createElement)("svg",{ref:a,...l,width:o,height:o,stroke:i,strokeWidth:d?24*Number(c)/Number(o):c,className:["lucide","lucide-".concat(n(e)),x].join(" "),...m},[...t.map(e=>{let[t,s]=e;return(0,r.createElement)(t,s)}),...Array.isArray(h)?h:[h]])});return s.displayName="".concat(e),s},o=i("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),c=i("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),d=i("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),x=i("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),h=i("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),m={active:(0,a.jsx)(o,{className:"w-4 h-4 text-blue-500"}),completed:(0,a.jsx)(c,{className:"w-4 h-4 text-green-500"}),blocked:(0,a.jsx)(d,{className:"w-4 h-4 text-red-500"}),archived:(0,a.jsx)(x,{className:"w-4 h-4 text-slate-400"})};function p(e){let{sessions:t,activeSession:s,loading:l,onSelectSession:n,onCreateSession:i}=e,[o,c]=(0,r.useState)(!1),[d,x]=(0,r.useState)(""),p=()=>{d.trim()&&(i(d.trim()),x(""),c(!1))},u=e=>{try{return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return e}};return(0,a.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,a.jsx)("div",{className:"p-3",children:o?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("input",{type:"text",value:d,onChange:e=>x(e.target.value),onKeyDown:e=>"Enter"===e.key&&p(),placeholder:"Session name...",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg  bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent placeholder:text-slate-400",autoFocus:!0}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:p,className:"flex-1 px-3 py-1.5 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors text-sm font-medium",children:"Create"}),(0,a.jsx)("button",{onClick:()=>c(!1),className:"px-3 py-1.5 text-slate-600 dark:text-slate-400 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors text-sm",children:"Cancel"})]})]}):(0,a.jsxs)("button",{onClick:()=>c(!0),className:"w-full flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg text-slate-600 dark:text-slate-400 hover:border-primary-500 hover:text-primary-500 transition-colors",children:[(0,a.jsx)(h,{className:"w-4 h-4"}),"New Session"]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:l?(0,a.jsx)("div",{className:"p-4 text-center text-slate-500",children:"Loading sessions..."}):0===t.length?(0,a.jsx)("div",{className:"p-4 text-center text-slate-500",children:"No sessions yet. Create one to get started!"}):(0,a.jsx)("div",{className:"space-y-1 p-2",children:t.map(e=>(0,a.jsxs)("button",{onClick:()=>n(e),className:"w-full text-left p-3 rounded-lg transition-colors ".concat((null==s?void 0:s.id)===e.id?"bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-800":"hover:bg-slate-100 dark:hover:bg-slate-700/50"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[m[e.status]||m.active,(0,a.jsx)("span",{className:"font-medium text-slate-900 dark:text-white truncate",children:e.name})]}),e.active_work&&(0,a.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1 truncate pl-6",children:e.active_work}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-2 pl-6",children:[(0,a.jsxs)("span",{className:"text-xs text-slate-400",children:["Cycle #",e.compaction_cycle]}),(0,a.jsx)("span",{className:"text-xs text-slate-400",children:u(e.updated_at)})]})]},e.id))})})]})}let u=i("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),y=i("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),f=i("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),g=i("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);function b(e){let{onTranscription:t}=e,[s,l]=(0,r.useState)(!1),[n,i]=(0,r.useState)(!0),[o,c]=(0,r.useState)(""),d=(0,r.useRef)(null);return((0,r.useEffect)(()=>{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){i(!1);return}let s=new e;return s.continuous=!0,s.interimResults=!0,s.lang="en-US",s.onresult=e=>{let s="",a="";for(let t=e.resultIndex;t<e.results.length;t++){let r=e.results[t][0].transcript;e.results[t].isFinal?s+=r:a+=r}s?(t(s),c("")):c(a)},s.onerror=e=>{console.error("Speech recognition error:",e.error),l(!1),c("")},s.onend=()=>{l(!1),c("")},d.current=s,()=>{s.abort()}},[t]),n)?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:()=>{d.current&&(s?(d.current.stop(),l(!1)):(d.current.start(),l(!0)))},className:"p-3 rounded-xl transition-colors ".concat(s?"bg-red-500 text-white animate-pulse":"bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600"),title:s?"Stop recording":"Start voice input",children:(0,a.jsx)(g,{className:"w-5 h-5"})}),s&&(0,a.jsx)("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-ping"}),o&&(0,a.jsxs)("div",{className:"absolute bottom-full right-0 mb-2 p-2 bg-slate-800 text-white text-sm rounded-lg max-w-xs",children:[(0,a.jsx)("span",{className:"text-slate-400",children:"Hearing: "}),o]})]}):(0,a.jsx)("button",{disabled:!0,className:"p-3 text-slate-400 rounded-xl cursor-not-allowed",title:"Voice input not supported in this browser",children:(0,a.jsx)(f,{className:"w-5 h-5"})})}function k(e){let{session:t}=e,[s,l]=(0,r.useState)([]),[n,i]=(0,r.useState)(""),[o,c]=(0,r.useState)(!1),[d,x]=(0,r.useState)(!1),h=(0,r.useRef)(null);(0,r.useEffect)(()=>{m()},[t.id]),(0,r.useEffect)(()=>{var e;null===(e=h.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[s]);let m=async()=>{try{let e=await fetch("/api/chat/".concat(t.id,"/messages"));if(e.ok){let t=await e.json();l(t.messages)}}catch(e){console.error("Failed to fetch messages:",e)}},p=async()=>{if(!n.trim()||o)return;let e={id:"temp-".concat(Date.now()),role:"user",content:n,timestamp:new Date().toISOString()};l(t=>[...t,e]),i(""),c(!0),x(!0);try{var s;let a=await fetch("/api/chat/".concat(t.id,"/stream"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:t.id,content:e.content})});if(!a.ok)throw Error("Failed to send message");let r=null===(s=a.body)||void 0===s?void 0:s.getReader(),n=new TextDecoder,i={id:"assistant-".concat(Date.now()),role:"assistant",content:"",timestamp:new Date().toISOString(),status:"streaming"};for(l(e=>[...e,i]);r;){let{done:e,value:t}=await r.read();if(e)break;for(let e of n.decode(t).split("\n"))if(e.startsWith("data: "))try{let t=JSON.parse(e.slice(6));t.content&&(i={...i,content:i.content+t.content},l(e=>e.map(e=>e.id===i.id?i:e)))}catch(e){}}l(e=>e.map(e=>e.id===i.id?{...e,status:"complete"}:e))}catch(e){console.error("Failed to send message:",e),l(e=>[...e,{id:"error-".concat(Date.now()),role:"system",content:"Failed to get response. Please try again.",timestamp:new Date().toISOString()}])}finally{c(!1),x(!1)}};return(0,a.jsxs)("div",{className:"flex-1 flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:[(0,a.jsx)("h2",{className:"font-semibold text-slate-900 dark:text-white",children:t.name}),(0,a.jsxs)("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:["Session ID: ",t.id]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===s.length?(0,a.jsxs)("div",{className:"text-center text-slate-500 dark:text-slate-400 py-8",children:[(0,a.jsx)("p",{children:"No messages yet. Start a conversation!"}),(0,a.jsx)("p",{className:"text-sm mt-2",children:"You can type or use the microphone for voice input."})]}):s.map(e=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[80%] rounded-2xl px-4 py-2 ".concat("user"===e.role?"bg-primary-500 text-white":"system"===e.role?"bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-200":"bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-white"),children:[(0,a.jsx)("p",{className:"whitespace-pre-wrap",children:e.content}),"streaming"===e.status&&(0,a.jsx)("span",{className:"inline-block w-2 h-4 bg-current animate-pulse ml-1"})]})},e.id)),(0,a.jsx)("div",{ref:h})]}),(0,a.jsx)("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:(0,a.jsxs)("div",{className:"flex items-end gap-2",children:[(0,a.jsx)("div",{className:"flex-1 relative",children:(0,a.jsx)("textarea",{value:n,onChange:e=>i(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),p())},placeholder:"Type a message or use voice input...",rows:1,className:"w-full px-4 py-3 pr-12 border border-slate-300 dark:border-slate-600  rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent placeholder:text-slate-400 resize-none",style:{minHeight:"48px",maxHeight:"120px"}})}),(0,a.jsx)(b,{onTranscription:e=>{i(e)}}),(0,a.jsx)("button",{onClick:p,disabled:!n.trim()||o,className:"p-3 bg-primary-500 text-white rounded-xl hover:bg-primary-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:o?(0,a.jsx)(u,{className:"w-5 h-5 animate-spin"}):(0,a.jsx)(y,{className:"w-5 h-5"})})]})})]})}let w=i("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),v=i("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);function j(){let[e,t]=(0,r.useState)([]),[s,l]=(0,r.useState)(null),[n,i]=(0,r.useState)(!0);(0,r.useEffect)(()=>{o()},[]);let o=async()=>{try{let e=await fetch("/api/sessions");if(e.ok){let a=await e.json();t(a.sessions),a.sessions.length>0&&!s&&l(a.sessions[0])}}catch(e){console.error("Failed to fetch sessions:",e)}finally{i(!1)}},c=async e=>{try{let s=await fetch("/api/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})});if(s.ok){let e=await s.json();t(t=>[e,...t]),l(e)}}catch(e){console.error("Failed to create session:",e)}};return(0,a.jsxs)("div",{className:"flex h-screen",children:[(0,a.jsxs)("aside",{className:"w-80 border-r border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700",children:[(0,a.jsxs)("h1",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[(0,a.jsx)(w,{className:"w-6 h-6 text-primary-500"}),"ContextHarness"]}),(0,a.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Session Manager"})]}),(0,a.jsx)(p,{sessions:e,activeSession:s,loading:n,onSelectSession:e=>{l(e)},onCreateSession:c})]}),(0,a.jsx)("main",{className:"flex-1 flex flex-col",children:s?(0,a.jsx)(k,{session:s}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(v,{className:"w-16 h-16 text-slate-300 dark:text-slate-600 mx-auto mb-4"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-slate-600 dark:text-slate-400",children:"No Session Selected"}),(0,a.jsx)("p",{className:"text-slate-500 dark:text-slate-500 mt-2",children:"Select a session from the sidebar or create a new one"})]})})})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=3883)}),_N_E=e.O()}]);